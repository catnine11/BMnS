<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gd.bmss.mapper.OrderDaoImpl">


<select id="selectStockable" resultType="BStatusVo">
 <![CDATA[
  SELECT  X.BOOK_SEQ FROM
(SELECT  B.BOOK_SEQ, B.STATUS_TITLE, B.STATUS_CODE, A.RETURN_DATE, B.BOOK_CODE,
           COUNT(*) OVER (PARTITION BY B.BOOK_CODE) AS BOOK_COUNT
    FROM BOOK_BORROW A
    RIGHT JOIN BOOK_STATUS B ON A.BOOK_SEQ = B.BOOK_SEQ
    WHERE (RETURN_DATE <= TO_DATE('20230913' || '000000', 'YYYYMMDDHH24MISS') - 1
           OR RETURN_DATE IS NULL)
           AND STATUS_CODE = 'A') X
WHERE X.BOOK_COUNT > 1 ]]>
</select>


<!-- 파라미터 타입 무엇으로 할지  -->
<update id="normalToStock">
  UPDATE BOOK_STATUS SET STATUS_CODE='B' WHERE BOOK_SEQ IN
  <foreach collection="list" item="book_seq" open="(" separator="," close=")">
    #{book_seq}
  </foreach>
</update>


<insert id="addStock">
INSERT INTO BOOK_STOCK
(STOCK_NUMBER, SELL_STATUS, BOOK_SEQ, BOOK_PRICE)
VALUES
<foreach collection="list" item="book_seq" separator=",">
    (STOCK_NUMBER.NEXTVAL, 'N', #{book_seq}, 0)
 </foreach>
</insert>





</mapper>
